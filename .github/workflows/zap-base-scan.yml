# can this output to $GITHUB_STEP_SUMMARY?

name: OWASP Base ZAP Security Scan

on:
  workflow_dispatch:
  # push:
  #   branches:
  #     - main
  # pull_request:
  #   branches:
  #     - main

  schedule:
    - cron: "0 3 * * 1-5"

jobs:
  zap-base-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: ZAP Base Scan
        uses: zaproxy/action-baseline@v0.15.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          docker_name: "ghcr.io/zaproxy/zaproxy:stable"
          target: "https://support-for-social-workers.education.gov.uk/"
          cmd_options: "-a -d 1000"
          allow_issue_writing: false
          artifact_name: "zap-base-scan-report"

      - name: Download ZAP report artifact
        uses: actions/download-artifact@v8
        with:
          name: zap-base-scan-report
          path: ./zap-report

      - name: List all files in zap-report
        run: find ./zap-report

      - name: Output ZAP report to GitHub Step Summary
        if: always()
        run: |
          if [ -f ./zap-report/report_md.md ]; then
            echo "## ðŸ” OWASP ZAP Security Scan Report" >> $GITHUB_STEP_SUMMARY
            cat ./zap-report/report_md.md >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ ZAP report_md.md not found." >> $GITHUB_STEP_SUMMARY
          fi
